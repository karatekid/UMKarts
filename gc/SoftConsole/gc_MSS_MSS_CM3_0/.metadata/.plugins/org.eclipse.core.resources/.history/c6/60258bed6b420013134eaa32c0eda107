#include <stdio.h>

typedef struct
{
    int8_t empty1 : 3;
    int8_t start : 1;
    int8_t y : 1;
    int8_t x : 1;
    int8_t b : 1;
    int8_t a : 1;
    int8_t empty2 : 1;
    int8_t l : 1;
    int8_t r : 1;
    int8_t z : 1;
    int8_t d_up : 1;
    int8_t d_down : 1;
    int8_t d_right : 1;
    int8_t d_left : 1;
    int8_t joystick_x : 8;
    int8_t joystick_y : 8;
    int8_t cstick_x : 8;
    int8_t cstick_y : 8;
    int8_t left : 8;
    int8_t right : 8;
} gc_t;

#define GC ((gc_t *) 0x40050000)

void print_gc() {
	if (GC->start)
		printf("Start ");
	if (GC->y)
		printf("Y ");
	if (GC->x)
		printf("X ");
	if (GC->b)
		printf("B ");
	if (GC->a)
		printf("A ");
	if (GC->l)
		printf("L ");
	if (GC->r)
		printf("R ");
	if (GC->z)
		printf("Z ");
	if (GC->d_up)
		printf("UP ");
	if (GC->d_down)
		printf("DOWN ");
	if (GC->d_right)
		printf("RIGHT ");
	if (GC->d_left)
		printf("LEFT ");
	printf("\n\r");
	printf("Joystick X: %d, Y: %d", GC->joystick_x, GC->joystick_y);
	printf("C stick X: %d, Y: %d", GC->cstick_x, GC->cstick_y);
	printf("Trigger Pressure Left: %d, Right: %d", GC->left, GC->right);
}

int main()
{
	volatile int d = 0;
	while( 1 )
	{
		print_gc();
		for (d = 0; d < 1000000; d++);
	}
}
