#include "sound.h"
#include "spi_flash.h"
#include "drivers/mss_ace/mss_ace.h"
#include "drivers/mss_gpio/mss_gpio.h"

void sound_init() {
	spi_flash_init();
}

void flash_write() {
	spi_flash_init();

	uint32_t addr = 0;
	uint8_t buf;

	MSS_UART_init( &g_mss_uart0,
				       MSS_UART_57600_BAUD,
				       MSS_UART_DATA_8_BITS | MSS_UART_NO_PARITY | MSS_UART_ONE_STOP_BIT );

	spi_flash_control_hw(SPI_FLASH_GLOBAL_UNPROTECT, 0, 0);
	spi_flash_control_hw(SPI_FLASH_CHIP_ERASE, 0, 0);
	while (1) {
		while (MSS_UART_get_rx(&g_mss_uart0, &buf, 1) == 0);
		spi_flash_write(addr, &buf, 1);
		addr++;
	}
}
