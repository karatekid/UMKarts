#ifndef __ATOMICS_H_
#define __ATOMICS_H_

static inline int ldrex(int *mem) {
	int result;
	asm volatile("ldrex %0, %1"
	                      :"=r"(result)
	                      :"m"(mem)
	                      :"memory");
	return result;
}

static inline int strex(int *mem, int val) {
	int old_value;
	asm volatile ("strex %0, %1, [%2]" : "=r" (old_value), "=r" (val) : "r" (mem) : "memory");
	return old_value;
}

static inline uint8_t ldrexb(uint8_t *mem) {
	uint8_t result;
	asm volatile("ldrexb %0, %1"
	                      :"=r"(result)
	                      :"m"(mem)
	                      :"memory");
	return result;
}

static inline unsigned char strexb(unsigned char *mem, uint8_t val) {
	uint8_t old_value;
	asm volatile ("strexb %0, %1, [%2]" : "=r" (old_value), "=r" (val) : "r" (mem) : "memory");
	return old_value;
}

#endif
